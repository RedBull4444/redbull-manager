<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RedBull Manager">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>RedBull Manager by Kaan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            color: white;
            padding: 15px 0;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .stats {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            text-align: center;
            gap: 10px;
        }

        .stat-item {
            flex: 1;
        }

        .stat-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #1e3a8a;
        }

        .fridge-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .fridge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .fridge-title {
            font-size: 18px;
            font-weight: 700;
        }

        .type-normal .fridge-title {
            color: #1e40af;
        }

        .type-zero .fridge-title {
            color: #0ea5e9;
        }

        .auto-fill-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .type-normal .auto-fill-btn {
            background: #1e40af;
        }

        .type-zero .auto-fill-btn {
            background: #0ea5e9;
        }

        .slots-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .slot {
            aspect-ratio: 1;
            border: 3px solid;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .type-normal .slot {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            border-color: #1e40af;
        }

        .type-zero .slot {
            background: linear-gradient(135deg, #06b6d4 0%, #22d3ee 100%);
            border-color: #0891b2;
        }

        .slot-number {
            position: absolute;
            top: 3px;
            left: 6px;
            font-size: 10px;
            font-weight: 700;
            color: rgba(255,255,255,0.7);
        }

        .slot-content {
            font-size: 32px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .slot.empty .slot-content {
            font-size: 40px;
        }

        .slot.filled .slot-content {
            font-size: 18px;
        }

        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: rgba(255,255,255,0.7);
            color: #1e3a8a;
            font-size: 15px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
        }

        .tab-btn.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .storage-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .input-group input,
        .input-group select {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
        }

        .add-btn {
            padding: 12px 20px;
            border: none;
            background: #10b981;
            color: white;
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .storage-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .storage-item {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            color: white;
        }

        .storage-item.normal {
            background: #1e40af;
        }

        .storage-item.zero {
            background: #0ea5e9;
        }

        .sales-list {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .sales-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 12px;
        }

        .sale-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .sale-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .sale-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }

        .sale-badge.normal {
            background: #1e40af;
        }

        .sale-badge.zero {
            background: #0ea5e9;
        }

        .sale-badge.paid {
            background: #10b981;
        }

        .sale-badge.unpaid {
            background: #ef4444;
        }

        .sale-actions {
            display: flex;
            gap: 6px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            color: white;
        }

        .btn-open {
            background: #f59e0b;
        }

        .btn-paid {
            background: #10b981;
        }

        .btn-undo {
            background: #6b7280;
        }

        .debts-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .debt-item {
            padding: 12px;
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .debt-name {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 3px;
        }

        .sale-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .sale-dialog.active {
            display: flex;
        }

        .sale-dialog-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 300px;
            text-align: center;
        }

        .sale-dialog-title {
            font-size: 20px;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 20px;
        }

        .sale-dialog-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .sale-dialog-btn {
            width: 80px;
            height: 80px;
            border: none;
            border-radius: 50%;
            font-size: 40px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .sale-dialog-btn:active {
            transform: scale(0.95);
        }

        .btn-paid-sale {
            background: #10b981;
            color: white;
        }

        .btn-unpaid-sale {
            background: #ef4444;
            color: white;
        }

        .debt-amount {
            color: #78350f;
            font-size: 14px;
        }

        .customer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .customer-item:hover {
            background: #e5e7eb;
        }

        .customer-item-name {
            font-weight: 600;
            color: #1e3a8a;
        }

        .manage-customer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .delete-customer-btn {
            padding: 6px 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ùÑÔ∏è RedBull Manager by Kaan</h1>
    </div>

    <div class="stats">
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-label">Verkauft</div>
                <div class="stat-value" id="soldCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Gesamt</div>
                <div class="stat-value" id="totalMoney">0,00 ‚Ç¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Bezahlt</div>
                <div class="stat-value" id="paidMoney">0,00 ‚Ç¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Offen</div>
                <div class="stat-value" id="unpaidMoney">0,00 ‚Ç¨</div>
            </div>
        </div>
    </div>

    <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('fridge')">K√ºhlschrank</button>
        <button class="tab-btn" onclick="switchTab('storage')">Lager</button>
        <button class="tab-btn" onclick="switchTab('sales')">Verk√§ufe</button>
        <button class="tab-btn" onclick="switchTab('customers')">Kunden</button>
    </div>

    <!-- RESET BUTTON -->
    <div style="text-align:center; margin: 10px 0 20px 0;">
        <button onclick="resetApp()"
            style="padding:12px 20px; background:#ef4444; color:white; border:none; border-radius:10px; font-size:15px; font-weight:700; box-shadow:0 3px 6px rgba(0,0,0,0.25);">
            üîÑ Alles zur√ºcksetzen
        </button>
    </div>

    <div id="fridgeTab" class="tab-content active">
        <div class="fridge-section type-normal">
            <div class="fridge-header">
                <div class="fridge-title">üîµ Red Bull Normal</div>
                <button class="auto-fill-btn" onclick="autoFill('normal')">Auto-F√ºllen</button>
            </div>
            <div class="slots-grid" id="normalSlots"></div>
        </div>

        <div class="fridge-section type-zero">
            <div class="fridge-header">
                <div class="fridge-title">üíé Red Bull Zero</div>
                <button class="auto-fill-btn" onclick="autoFill('zero')">Auto-F√ºllen</button>
            </div>
            <div class="slots-grid" id="zeroSlots"></div>
        </div>
    </div>

    <div id="storageTab" class="tab-content">
        <div class="storage-section">
            <h3 class="sales-title">üì¶ Lager verwalten</h3>
            <div class="input-group">
                <input type="number" id="rangeFrom" placeholder="Von" min="1" max="200">
                <input type="number" id="rangeTo" placeholder="Bis" min="1" max="200">
                <select id="rangeType">
                    <option value="normal">Normal</option>
                    <option value="zero">Zero</option>
                </select>
            </div>
            <button class="add-btn" onclick="addRange()">‚ûï Bereich anlegen</button>
            <div class="storage-list" id="storageList"></div>
        </div>
    </div>

    <div id="salesTab" class="tab-content">
        <div class="sales-list">
            <h3 class="sales-title">üí∞ Verk√§ufe</h3>
            <div id="salesList"></div>
        </div>

        <div class="debts-section">
            <h3 class="sales-title">‚ö†Ô∏è Schuldenliste</h3>
            <div id="debtsList"></div>
        </div>
    </div>

    <div class="sale-dialog" id="saleDialog">
        <div class="sale-dialog-content">
            <div class="sale-dialog-title">Verkaufen?</div>
            <div class="sale-dialog-buttons">
                <button class="sale-dialog-btn btn-paid-sale" onclick="completeSale(true)">‚úì</button>
                <button class="sale-dialog-btn btn-unpaid-sale" onclick="showCustomerSelect()">‚úï</button>
            </div>
        </div>
    </div>

    <div class="sale-dialog" id="customerDialog">
        <div class="sale-dialog-content" style="max-width: 350px;">
            <div class="sale-dialog-title">Kunde w√§hlen</div>
            <div style="margin-bottom: 15px;">
                <input type="text" id="newCustomerName" placeholder="Neuer Kunde..." 
                    style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px;">
                <button onclick="addNewCustomer()" 
                    style="width: 100%; margin-top: 8px; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    + Neuer Kunde
                </button>
            </div>
            <div id="customerList" style="max-height: 200px; overflow-y: auto;"></div>
            <button onclick="closeCustomerDialog()" 
                style="width: 100%; margin-top: 15px; padding: 10px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                Abbrechen
            </button>
        </div>
    </div>

    <div class="tab-nav" style="margin-top: 15px;">
        <button class="tab-btn" onclick="switchTab('customers')">Kunden verwalten</button>
    </div>

    <div id="customersTab" class="tab-content">
        <div class="storage-section">
            <h3 class="sales-title">üë• Kunden verwalten</h3>
            <div style="margin-bottom: 15px;">
                <input type="text" id="manageNewCustomerName" placeholder="Neuer Kunde..." 
                    style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; margin-bottom: 8px;"
                    onkeypress="if(event.key === 'Enter') addCustomerFromManage()">
                <button onclick="addCustomerFromManage()" class="add-btn">
                    ‚ûï Kunde hinzuf√ºgen
                </button>
            </div>
            <div id="manageCustomersList"></div>
        </div>
    </div>

    <script>
        let cans = JSON.parse(localStorage.getItem('redbullCans')) || [];
        let customers = JSON.parse(localStorage.getItem('redbullCustomers')) || [];
        let currentSaleCan = null;

        function saveData() {
            localStorage.setItem('redbullCans', JSON.stringify(cans));
            localStorage.setItem('redbullCustomers', JSON.stringify(customers));
            render();
        }

        function saveCans() {
            saveData();
        }

        function showSaleDialog(can) {
            currentSaleCan = can;
            document.getElementById('saleDialog').classList.add('active');
        }

        function showCustomerSelect() {
            document.getElementById('saleDialog').classList.remove('active');
            document.getElementById('customerDialog').classList.add('active');
            renderCustomerList();
        }

        function closeCustomerDialog() {
            document.getElementById('customerDialog').classList.remove('active');
            document.getElementById('newCustomerName').value = '';
            currentSaleCan = null;
        }

        function addNewCustomer() {
            const name = document.getElementById('newCustomerName').value.trim();
            if (!name) {
                alert('Bitte einen Namen eingeben!');
                return;
            }
            
            if (!customers.includes(name)) {
                customers.push(name);
            }
            
            selectCustomer(name);
        }

        function selectCustomer(name) {
            if (!currentSaleCan) return;

            currentSaleCan.status = 'sold';
            currentSaleCan.paid = false;
            currentSaleCan.slotIndex = null;
            currentSaleCan.creditName = name;

            document.getElementById('customerDialog').classList.remove('active');
            document.getElementById('newCustomerName').value = '';
            currentSaleCan = null;
            saveData();
        }

        function renderCustomerList() {
            const container = document.getElementById('customerList');
            
            if (customers.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 20px;">Noch keine Kunden gespeichert</p>';
                return;
            }

            container.innerHTML = customers.map(name => `
                <div class="customer-item" onclick="selectCustomer('${name}')">
                    <span class="customer-item-name">${name}</span>
                </div>
            `).join('');
        }

        function renderManageCustomers() {
            const container = document.getElementById('manageCustomersList');
            
            if (customers.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 20px;">Noch keine Kunden gespeichert</p>';
                return;
            }

            container.innerHTML = customers.map(name => `
                <div class="manage-customer-item">
                    <span style="font-weight: 600; color: #1e3a8a;">${name}</span>
                    <button class="delete-customer-btn" onclick="deleteCustomer('${name}')">L√∂schen</button>
                </div>
            `).join('');
        }

        function deleteCustomer(name) {
            if (confirm(`Kunde "${name}" wirklich l√∂schen?`)) {
                customers = customers.filter(c => c !== name);
                saveData();
            }
        }

        function addCustomerFromManage() {
            const name = document.getElementById('manageNewCustomerName').value.trim();
            if (!name) {
                alert('Bitte einen Namen eingeben!');
                return;
            }
            
            if (customers.includes(name)) {
                alert('Dieser Kunde existiert bereits!');
                return;
            }
            
            customers.push(name);
            document.getElementById('manageNewCustomerName').value = '';
            saveData();
        }

        function completeSale(isPaid) {
            if (!currentSaleCan) return;

            if (isPaid) {
                // Gr√ºnes H√§kchen - direkt bezahlt
                currentSaleCan.status = 'sold';
                currentSaleCan.paid = true;
                currentSaleCan.slotIndex = null;
                currentSaleCan.creditName = null;
            }

            document.getElementById('saleDialog').classList.remove('active');
            currentSaleCan = null;
            saveCans();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelectorAll(`.tab-btn`).forEach(btn => {
                if (btn.getAttribute('onclick') === `switchTab('${tab}')`) {
                    btn.classList.add('active');
                }
            });

            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function renderSlots(type) {
            const container = document.getElementById(type + 'Slots');
            container.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const can = cans.find(c => c.type === type && c.slotIndex === i && c.status === 'fridge');
                const slot = document.createElement('div');
                slot.className = 'slot ' + (can ? 'filled' : 'empty');
                slot.onclick = () => handleSlotClick(type, i, can);
                
                slot.innerHTML = `
                    <div class="slot-number">${i + 1}</div>
                    <div class="slot-content">${can ? '#' + can.nr : '+'}</div>
                `;
                
                container.appendChild(slot);
            }
        }

        function handleSlotClick(type, slotIndex, can) {
            if (can) {
                // Verkaufen - zeige Auswahl
                showSaleDialog(can);
            } else {
                // Neue Dose einf√ºgen
                const nr = prompt('Welche Nummer stellst du in diesen Slot? (1-200)');
                if (!nr) return;
                
                const num = parseInt(nr);
                if (num < 1 || num > 200 || isNaN(num)) {
                    alert('Bitte eine Nummer zwischen 1 und 200 eingeben!');
                    return;
                }
                
                // Check if number already exists for this type (not in lager)
                const existsInFridgeOrSold = cans.find(c => c.nr === num && c.type === type && c.status !== 'lager');
                if (existsInFridgeOrSold) {
                    alert('Diese Nummer ist bereits im K√ºhlschrank oder wurde verkauft!');
                    return;
                }
                
                // Check if number exists in storage
                const inStorage = cans.find(c => c.nr === num && c.type === type && c.status === 'lager');
                
                if (inStorage) {
                    // Move from storage to fridge
                    inStorage.status = 'fridge';
                    inStorage.slotIndex = slotIndex;
                } else {
                    // Create new can (not in lager)
                    cans.push({
                        nr: num,
                        type: type,
                        status: 'fridge',
                        slotIndex: slotIndex,
                        paid: null,
                        creditName: null
                    });
                }
                
                saveCans();
            }
        }

        function addRange() {
            const from = parseInt(document.getElementById('rangeFrom').value);
            const to = parseInt(document.getElementById('rangeTo').value);
            const type = document.getElementById('rangeType').value;
            
            if (!from || !to || from > to || from < 1 || to > 200) {
                alert('Bitte g√ºltige Nummern eingeben!');
                return;
            }
            
            for (let i = from; i <= to; i++) {
                const exists = cans.find(c => c.nr === i && c.type === type);
                if (!exists) {
                    cans.push({
                        nr: i,
                        type: type,
                        status: 'lager',
                        slotIndex: null,
                        paid: null,
                        creditName: null
                    });
                }
            }
            
            document.getElementById('rangeFrom').value = '';
            document.getElementById('rangeTo').value = '';
            saveCans();
        }

        function autoFill(type) {
            const storageCans = cans.filter(c => c.type === type && c.status === 'lager').sort((a, b) => a.nr - b.nr);
            
            for (let i = 0; i < 8; i++) {
                const slotFilled = cans.find(c => c.type === type && c.slotIndex === i && c.status === 'fridge');
                if (!slotFilled && storageCans.length > 0) {
                    const can = storageCans.shift();
                    can.status = 'fridge';
                    can.slotIndex = i;
                }
            }
            
            saveCans();
        }

        function renderStorage() {
            const container = document.getElementById('storageList');
            const storageCans = cans.filter(c => c.status === 'lager').sort((a, b) => a.nr - b.nr);
            
            container.innerHTML = storageCans.map(c => 
                `<div class="storage-item ${c.type}">#${c.nr}</div>`
            ).join('');
        }

        function renderSales() {
            const container = document.getElementById('salesList');
            const soldCans = cans.filter(c => c.status === 'sold').sort((a, b) => b.nr - a.nr);
            
            if (soldCans.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center;">Noch keine Verk√§ufe</p>';
                return;
            }
            
            container.innerHTML = soldCans.map(c => `
                <div class="sale-item">
                    <div class="sale-info">
                        <div class="sale-badge ${c.type}">${c.type.toUpperCase()}</div>
                        <strong>#${c.nr}</strong>
                        <span>2,00 ‚Ç¨</span>
                        ${c.paid === false ? `<div class="sale-badge unpaid">${c.creditName}</div>` : ''}
                        ${c.paid === true ? `<div class="sale-badge paid">‚úì</div>` : ''}
                    </div>
                    <div class="sale-actions">
                        ${c.paid === true ? `<button class="action-btn btn-open" onclick="markUnpaid(${c.nr}, '${c.type}')">offen</button>` : ''}
                        ${c.paid === false ? `<button class="action-btn btn-paid" onclick="markPaid(${c.nr}, '${c.type}')">bez</button>` : ''}
                        <button class="action-btn btn-undo" onclick="undoSale(${c.nr}, '${c.type}')">‚Ü©</button>
                    </div>
                </div>
            `).join('');
        }

        function markUnpaid(nr, type) {
            const can = cans.find(c => c.nr === nr && c.type === type);
            if (can) {
                const name = prompt('Name des Kunden:');
                if (name) {
                    can.paid = false;
                    can.creditName = name;
                    saveCans();
                }
            }
        }

        function markPaid(nr, type) {
            const can = cans.find(c => c.nr === nr && c.type === type);
            if (can) {
                can.paid = true;
                can.creditName = null;
                saveCans();
            }
        }

        function undoSale(nr, type) {
            const can = cans.find(c => c.nr === nr && c.type === type);
            if (can) {
                // Find first empty slot
                for (let i = 0; i < 8; i++) {
                    const slotFilled = cans.find(c => c.type === type && c.slotIndex === i && c.status === 'fridge');
                    if (!slotFilled) {
                        can.status = 'fridge';
                        can.slotIndex = i;
                        can.paid = null;
                        can.creditName = null;
                        saveCans();
                        return;
                    }
                }
                alert('Keine freien Slots verf√ºgbar!');
            }
        }

        function renderDebts() {
            const container = document.getElementById('debtsList');
            const unpaidCans = cans.filter(c => c.status === 'sold' && c.paid === false);
            
            if (unpaidCans.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center;">Keine offenen Schulden</p>';
                return;
            }
            
            const debtsByName = {};
            unpaidCans.forEach(c => {
                if (!debtsByName[c.creditName]) {
                    debtsByName[c.creditName] = 0;
                }
                debtsByName[c.creditName]++;
            });
            
            container.innerHTML = Object.entries(debtsByName).map(([name, count]) => `
                <div class="debt-item">
                    <div class="debt-name">${name}</div>
                    <div class="debt-amount">${count} Dose${count > 1 ? 'n' : ''} = ${(count * 2).toFixed(2)} ‚Ç¨</div>
                </div>
            `).join('');
        }

        function updateStats() {
            const soldCans = cans.filter(c => c.status === 'sold');
            const paidCans = soldCans.filter(c => c.paid === true);
            const unpaidCans = soldCans.filter(c => c.paid === false);
            
            document.getElementById('soldCount').textContent = soldCans.length;
            document.getElementById('totalMoney').textContent = (soldCans.length * 2).toFixed(2) + ' ‚Ç¨';
            document.getElementById('paidMoney').textContent = (paidCans.length * 2).toFixed(2) + ' ‚Ç¨';
            document.getElementById('unpaidMoney').textContent = (unpaidCans.length * 2).toFixed(2) + ' ‚Ç¨';
        }

        // RESET-FUNKTION
        function resetApp() {
            if (confirm("Willst du WIRKLICH alles l√∂schen? (Lager, K√ºhlschrank, Verk√§ufe, Kunden)")) {
                localStorage.removeItem('redbullCans');
                localStorage.removeItem('redbullCustomers');
                cans = [];
                customers = [];
                render();
            }
        }

        function render() {
            renderSlots('normal');
            renderSlots('zero');
            renderStorage();
            renderSales();
            renderDebts();
            renderManageCustomers();
            updateStats();
        }

        render();
    </script>
</body>
</html>
